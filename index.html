<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ViralFlowr | Boutique Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#2563eb;
  --primary2:#60a5fa;
  --dark:#0b1220;
  --text:#0f172a;
  --muted:#64748b;
  --card:#ffffff;
  --bg:#f6f8fc;
  --line:#e6edf7;
  --shadow: 0 20px 40px rgba(2, 8, 23, .08);
  --shadow2: 0 10px 20px rgba(2, 8, 23, .08);
  --radius:18px;
}

*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{
  font-family:'Plus Jakarta Sans',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background: radial-gradient(1200px 600px at 50% -60px, rgba(37,99,235,.14), transparent 60%),
              radial-gradient(800px 400px at 10% 0, rgba(96,165,250,.10), transparent 60%),
              var(--bg);
  color:var(--text);
}

/* Top bar */
.topbar{
  background: linear-gradient(90deg, rgba(37,99,235,.12), rgba(96,165,250,.12));
  border-bottom:1px solid var(--line);
  padding:10px 14px;
  font-size:13px;
  color:var(--muted);
  text-align:center;
}
.topbar strong{color:var(--text)}

/* Header */
header{
  position:sticky;
  top:0;
  z-index:50;
  background: rgba(255,255,255,.85);
  backdrop-filter: blur(10px);
  border-bottom:1px solid var(--line);
}
.header-inner{
  max-width:1200px;
  margin:0 auto;
  padding:14px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.brand{
  display:flex;
  align-items:center;
  gap:10px;
  text-decoration:none;
  color:var(--text);
}
.brand img{height:38px;width:38px;border-radius:12px}
.brand .name{
  font-weight:800;
  letter-spacing:-.02em;
  line-height:1.05;
}
.brand .name span{color:var(--primary)}
.brand .tag{font-size:12px;color:var(--muted);font-weight:600}

.header-actions{
  display:flex;
  gap:8px;
  align-items:center;
}
.chip-link{
  border:1px solid var(--line);
  background:#fff;
  padding:9px 12px;
  border-radius:999px;
  text-decoration:none;
  color:var(--text);
  font-weight:700;
  font-size:13px;
  box-shadow: 0 6px 14px rgba(2, 8, 23, .05);
}
.chip-link:hover{transform:translateY(-1px); box-shadow: var(--shadow2)}

/* Layout container */
.container{
  max-width:1200px;
  margin:0 auto;
  padding:0 14px 34px;
}

/* Hero */
.hero{ padding:24px 0 18px; }
.hero-card{
  background: linear-gradient(135deg, rgba(37,99,235,.10), rgba(96,165,250,.10));
  border:1px solid var(--line);
  border-radius: calc(var(--radius) + 8px);
  padding:20px;
  box-shadow: var(--shadow);
  overflow:hidden;
  position:relative;
}
.hero-card:before{
  content:"";
  position:absolute; inset:-2px;
  background: radial-gradient(600px 200px at 20% 0, rgba(37,99,235,.18), transparent 55%),
              radial-gradient(600px 220px at 80% 0, rgba(96,165,250,.16), transparent 55%);
  pointer-events:none;
}
.hero-grid{
  position:relative;
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:18px;
  align-items:center;
}
.hero h1{
  margin:0 0 10px;
  font-size:28px;
  line-height:1.15;
  letter-spacing:-.03em;
}
.hero p{ margin:0 0 14px; color:var(--muted); font-weight:600; }
.hero-bullets{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin: 0 0 14px;
  padding:0;
  list-style:none;
}
.hero-bullets li{
  background: rgba(255,255,255,.70);
  border:1px solid var(--line);
  border-radius:999px;
  padding:8px 10px;
  font-size:12px;
  font-weight:800;
  color:#0b1220;
}
.hero-cta{ display:flex; gap:10px; flex-wrap:wrap; }
.btn{
  border:none;
  cursor:pointer;
  font-weight:800;
  border-radius:12px;
  padding:12px 14px;
  font-size:14px;
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:8px;
}
.btn-primary{
  background: linear-gradient(135deg, var(--primary), var(--primary2));
  color:#fff;
  box-shadow: 0 12px 26px rgba(37,99,235,.25);
}
.btn-primary:hover{transform:translateY(-1px)}
.btn-ghost{
  background: rgba(255,255,255,.75);
  color:var(--text);
  border:1px solid var(--line);
}

/* Search + stats */
.hero-right{
  background: rgba(255,255,255,.70);
  border:1px solid var(--line);
  border-radius: calc(var(--radius) + 6px);
  padding:14px;
}
.search{
  display:flex;
  gap:10px;
  align-items:center;
  background:#fff;
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
}
.search input{
  border:none; outline:none; width:100%;
  font-size:14px; font-weight:700; color:var(--text);
}
.search .kbd{
  font-size:12px; font-weight:800; color:var(--muted);
  border:1px solid var(--line);
  border-bottom-width:2px;
  border-radius:10px;
  padding:6px 8px;
  background:#f8fafc;
}
.hero-stats{
  display:grid;
  grid-template-columns: repeat(3,1fr);
  gap:10px;
  margin-top:12px;
}
.stat{
  background:#fff;
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px;
}
.stat .k{font-size:11px;color:var(--muted);font-weight:800}
.stat .v{font-size:16px;font-weight:900;margin-top:2px;letter-spacing:-.02em}

/* Categories nav */
.categories-nav{
  margin:14px 0 0;
  display:flex;
  gap:8px;
  overflow:auto;
  padding:6px 2px 10px;
  scrollbar-width: none;
}
.categories-nav::-webkit-scrollbar{display:none}
.cat-btn{
  flex:0 0 auto;
  background: rgba(255,255,255,.80);
  border:1px solid var(--line);
  padding:10px 12px;
  border-radius:999px;
  cursor:pointer;
  font-weight:800;
  font-size:13px;
  color:var(--muted);
  transition:.2s;
  box-shadow: 0 10px 18px rgba(2,8,23,.05);
}
.cat-btn.active,
.cat-btn:hover{
  color:#fff;
  border-color: transparent;
  background: linear-gradient(135deg, var(--dark), #111827);
}

/* Grid */
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:16px;
}

/* Card */
.product-card{
  background: rgba(255,255,255,.85);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  border:1px solid var(--line);
  overflow:hidden;
  transition:.25s;
  box-shadow: 0 10px 24px rgba(2,8,23,.06);
}
.product-card:hover{
  transform:translateY(-6px);
  box-shadow: var(--shadow);
  border-color: rgba(37,99,235,.30);
}
.card-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 14px 0;
}
.badge{
  font-size:11px;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:.06em;
  color:var(--primary);
  background:#eff6ff;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(37,99,235,.15);
}
.price-pill{
  font-size:13px;
  font-weight:900;
  color:#0b1220;
  background:#fff;
  border:1px solid var(--line);
  padding:6px 10px;
  border-radius:999px;
}
.price-pill span{color:var(--muted);font-weight:800;font-size:12px;margin-right:4px}

.card-mid{
  display:flex;
  gap:12px;
  padding:12px 14px 14px;
  align-items:center;
}
.card-image{
  width:62px;height:62px;
  border-radius:16px;
  background: linear-gradient(135deg,#f1f5f9,#e2e8f0);
  display:flex;align-items:center;justify-content:center;
  border:1px solid var(--line);
  flex-shrink:0;
}
.card-image img{max-width:40px;max-height:40px}
.card-body{flex:1;min-width:0}
.product-title{
  font-size:14px;
  font-weight:900;
  margin:0 0 6px;
  color:var(--dark);
  letter-spacing:-.01em;
}
.limits{
  font-size:12px;
  color:var(--muted);
  font-weight:700;
  margin:0;
}

/* Desc preview */
.product-desc{
  margin:6px 0 0;
  color:var(--muted);
  font-size:12px;
  line-height:1.35;
  font-weight:700;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  opacity:.95;
}

/* CTA */
.card-actions{ padding:0 14px 14px; }
.btn-buy{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  text-align:center;
  padding:12px;
  background: linear-gradient(135deg, #0b1220, #111827);
  color:#fff;
  border-radius:14px;
  text-decoration:none;
  font-weight:900;
  border:1px solid rgba(255,255,255,.08);
}
.btn-buy:hover{transform:translateY(-1px)}

/* Loading / empty */
.loading{
  text-align:center;
  padding:60px 14px;
  font-weight:800;
  color:var(--muted);
}
.skeleton{
  border-radius: var(--radius);
  border:1px solid var(--line);
  background: linear-gradient(90deg, #ffffff, #f3f6ff, #ffffff);
  background-size: 200% 100%;
  animation: shimmer 1.1s infinite linear;
  height: 140px;
}
@keyframes shimmer{0%{background-position:0 0}100%{background-position:-200% 0}}

/* Footer */
footer{
  background: rgba(255,255,255,.90);
  border-top:1px solid var(--line);
  padding:28px 14px;
  text-align:center;
  color:var(--muted);
}
footer strong{color:var(--text)}
.footer-links{
  margin-top:10px;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}
.footer-links a{
  color:var(--text);
  text-decoration:none;
  font-weight:800;
  border:1px solid var(--line);
  padding:9px 12px;
  border-radius:999px;
  background:#fff
}
.footer-links a:hover{transform:translateY(-1px);box-shadow:var(--shadow2)}

@media(max-width:900px){
  .hero-grid{grid-template-columns:1fr}
  .hero h1{font-size:24px}
}
</style>
</head>

<body>

<div class="topbar">
  ‚ö° <strong>ViralFlowr</strong> ‚Äî Services rapides ‚Ä¢ Prix transparents ‚Ä¢ Support WhatsApp/Telegram
</div>

<header>
  <div class="header-inner">
    <a href="#" class="brand">
      <img src="https://cdn-icons-png.flaticon.com/512/11520/11520110.png" alt="ViralFlowr">
      <div>
        <div class="name">Viral<span>Flowr</span></div>
        <div class="tag">Boutique Pro</div>
      </div>
    </a>
    <div class="header-actions">
      <a class="chip-link" href="#catalogue">Catalogue</a>
      <a class="chip-link" href="https://wa.me/" target="_blank" rel="noopener">WhatsApp</a>
    </div>
  </div>
</header>

<div class="container">
  <section class="hero">
    <div class="hero-card">
      <div class="hero-grid">
        <div>
          <h1>Commandez vos services en 1 clic ‚Äî style ‚Äúmarketplace premium‚Äù.</h1>
          <p>Filtre par cat√©gories, recherche instantan√©e, cartes propres et rapides sur mobile.</p>

          <ul class="hero-bullets">
            <li>‚úÖ Livraison rapide</li>
            <li>‚úÖ Prix clairs</li>
            <li>‚úÖ Support 7/7</li>
          </ul>

          <div class="hero-cta">
            <a class="btn btn-primary" href="#catalogue">Voir le catalogue</a>
            <a class="btn btn-ghost" href="#support">Contacter le support</a>
          </div>
        </div>

        <div class="hero-right">
          <div class="search">
            <input id="searchInput" type="search" placeholder="Rechercher un service‚Ä¶ (ex: Netflix, IMEI, Boost)" autocomplete="off">
            <span class="kbd">Ctrl K</span>
          </div>

          <div class="hero-stats">
            <div class="stat">
              <div class="k">Cat√©gories</div>
              <div class="v" id="statCats">‚Äî</div>
            </div>
            <div class="stat">
              <div class="k">Services</div>
              <div class="v" id="statCount">‚Äî</div>
            </div>
            <div class="stat">
              <div class="k">Disponible</div>
              <div class="v">24/7</div>
            </div>
          </div>
        </div>
      </div>

      <div class="categories-nav" aria-label="Cat√©gories">
        <button class="cat-btn active" data-filter="all">‚ö° Tous</button>
        <button class="cat-btn" data-filter="IMEI">üì± IMEI</button>
        <button class="cat-btn" data-filter="Boost,Boost2">üöÄ Boost</button>
        <button class="cat-btn" data-filter="Carte">üí≥ Cartes</button>
        <button class="cat-btn" data-filter="Abonnement">üì∫ Abonnements</button>
      </div>
    </div>
  </section>

  <section id="catalogue">
    <div id="product-grid" class="grid" aria-live="polite">
      <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
    </div>
  </section>
</div>

<footer id="support">
  <strong>ViralFlowr</strong>
  <div class="footer-links">
    <a href="https://wa.me/" target="_blank" rel="noopener">WhatsApp</a>
    <a href="#" target="_blank" rel="noopener">Telegram</a>
  </div>
  <p style="font-size:12px;margin-top:14px;">¬© 2026 ViralFlowr</p>
</footer>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbyCvuy-WiLMlAkBb7k6YyPVMk4lQhGGke05heSWSw--twKE2L-oVSOs884g3jn6lt6m/exec";

const CATEGORY_ICONS={
  IMEI:"https://cdn-icons-png.flaticon.com/512/2544/2544574.png",
  Boost:"https://cdn-icons-png.flaticon.com/512/1441/1441180.png",
  Boost2:"https://cdn-icons-png.flaticon.com/512/1441/1441180.png",
  Carte:"https://cdn-icons-png.flaticon.com/512/633/633611.png",
  Abonnement:"https://cdn-icons-png.flaticon.com/512/3165/3165247.png",
  default:"https://cdn-icons-png.flaticon.com/512/11520/11520110.png"
};

let PRODUCTS = [];
let CURRENT_FILTER = "all";
let QUERY = "";

/* prevent HTML injection */
function escapeHTML(str=""){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ‚úÖ NEW: read query param from a full URL (pay_link) */
function getParamFromUrl(url, key){
  try{
    if(!url) return "";
    const u = new URL(String(url), window.location.href);
    return u.searchParams.get(key) || "";
  }catch(e){
    return "";
  }
}

/* ‚úÖ NEW: safe decode (handles already decoded / bad strings) */
function safeDecode(val){
  try{
    return decodeURIComponent(String(val || ""));
  }catch(e){
    return String(val || "");
  }
}

/* JSONP one-time */
function fetchProductsOnce(){
  const s = document.createElement('script');
  s.src = SCRIPT_URL + "?action=get_products&callback=onProductsLoaded";
  document.body.appendChild(s);
}

/* Called by JSONP */
function onProductsLoaded(products){
  PRODUCTS = Array.isArray(products) ? products : [];
  updateStats();
  render();
}

function updateStats(){
  const cats = new Set(PRODUCTS.map(p => p.cat).filter(Boolean));
  document.getElementById("statCats").textContent = cats.size || "‚Äî";
  document.getElementById("statCount").textContent = PRODUCTS.length || "‚Äî";
}

function parseFilterValue(val){
  if(val === "all") return "all";
  if(val.includes(",")) return val.split(",").map(s => s.trim()).filter(Boolean);
  return val;
}

function setActiveButton(btn){
  document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

function matchFilter(p){
  if(CURRENT_FILTER === "all") return true;
  if(Array.isArray(CURRENT_FILTER)) return CURRENT_FILTER.includes(p.cat);
  return p.cat === CURRENT_FILTER;
}

function matchQuery(p){
  if(!QUERY) return true;
  const q = QUERY.toLowerCase();
  const name = (p.nom || "").toLowerCase();
  const cat = (p.cat || "").toLowerCase();
  return name.includes(q) || cat.includes(q);
}

function render(){
  const grid = document.getElementById('product-grid');
  const filtered = PRODUCTS.filter(p => matchFilter(p) && matchQuery(p));

  if(!filtered.length){
    grid.innerHTML = '<div class="loading">Aucun service trouv√©.</div>';
    return;
  }

  grid.innerHTML = filtered.map(p => {
    const fallback = CATEGORY_ICONS[p.cat] || CATEGORY_ICONS.default;
    const img = (p.img && String(p.img).trim() !== "") ? p.img : fallback;

    const price = Number.parseFloat(p.prix);
    const priceText = Number.isFinite(price) ? price.toFixed(2) : (p.prix || "0.00");

    const limits = (p.min && p.max)
      ? `<p class="limits">Min ${escapeHTML(p.min)} ‚Ä¢ Max ${escapeHTML(p.max)}</p>`
      : `<p class="limits">Disponible imm√©diatement</p>`;

    // ‚úÖ IMPORTANT: Commander uses pay_link from Sheet (colonne F = LienCommande)
    const payLink = (p.pay_link && String(p.pay_link).trim() !== "")
      ? String(p.pay_link).trim()
      : "https://ndyno1.github.io/check_binance.py/";

    // ‚úÖ NEW: auto description comes from:
    // 1) p.long_desc (if API provides)
    // 2) p.description (if API provides)
    // 3) URL param long (from pay_link)
    // 4) URL param desc (from pay_link)
    const urlLong = safeDecode(getParamFromUrl(payLink, "long")).trim();
    const urlDesc = safeDecode(getParamFromUrl(payLink, "desc")).trim();

    const desc = (p.long_desc && String(p.long_desc).trim() !== "")
      ? String(p.long_desc).trim()
      : (p.description && String(p.description).trim() !== "")
        ? String(p.description).trim()
        : (urlLong !== "" ? urlLong : (urlDesc !== "" ? urlDesc : ""));

    const descHTML = desc ? `<div class="product-desc">${escapeHTML(desc)}</div>` : "";

    return `
      <article class="product-card">
        <div class="card-top">
          <span class="badge">${escapeHTML(p.cat || "Service")}</span>
          <div class="price-pill"><span>$</span>${escapeHTML(priceText)}</div>
        </div>

        <div class="card-mid">
          <div class="card-image">
            <img src="${img}" alt="" onerror="this.src='${fallback}'">
          </div>
          <div class="card-body">
            <h3 class="product-title">${escapeHTML(p.nom || "Produit")}</h3>
            ${descHTML}
            ${limits}
          </div>
        </div>

        <div class="card-actions">
          <a class="btn-buy" href="${payLink}">Commander ‚Üí</a>
        </div>
      </article>
    `;
  }).join("");
}

/* Events */
document.addEventListener("click", (e)=>{
  const btn = e.target.closest(".cat-btn");
  if(!btn) return;
  setActiveButton(btn);
  CURRENT_FILTER = parseFilterValue(btn.dataset.filter || "all");
  render();
});

const searchInput = document.getElementById("searchInput");
searchInput.addEventListener("input", ()=>{
  QUERY = searchInput.value.trim();
  render();
});

/* Ctrl+K focus */
document.addEventListener("keydown", (e)=>{
  if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k"){
    e.preventDefault();
    searchInput.focus();
  }
});

/* Init */
fetchProductsOnce();
</script>
</body>
</html>
