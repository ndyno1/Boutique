<!doctype html>
<html lang="fr" class="font-inter">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ViralFlowr | Boutique</title>

  <!-- Tailwind (comme ton wallet.html) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    body{ font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#F3F3F3; color:#201B16; overflow-x:hidden; }
    .text-orange-bsv{ color:#F07E13; }
    .brand-gradient{ background:linear-gradient(90deg,#F07E13 0%,#FFB26B 100%); }
    .brand-gradient:hover{ background:linear-gradient(90deg,#d96d0c 0%,#F07E13 100%); }
    .card{ background:#fff; border:1px solid #eee; border-radius:24px; box-shadow:0 12px 25px rgba(0,0,0,.06); }
    .input{
      width:100%; height:44px; padding:0 16px; border-radius:999px;
      background:#F2F4F5; border:1px solid transparent;
      outline:none; font-weight:700; font-size:13px;
    }
    .input:focus{ border-color:#F07E13; box-shadow:0 10px 25px rgba(240,126,19,.12); background:#fff; }
    .btn{
      height:40px; padding:0 14px; border-radius:14px;
      font-weight:900; font-size:12px; letter-spacing:.08em;
      text-transform:uppercase; display:inline-flex; align-items:center; justify-content:center; gap:8px;
      transition:.2s; white-space:nowrap;
    }
    .btn:hover{ transform:translateY(-1px); }
    .btn-outline{ background:#fff; border:1px solid #E5E7EB; color:#111827; }
    .btn-outline:hover{ border-color:#F07E13; color:#F07E13; }
    .icon-btn{
      display:flex; align-items:center; justify-content:center;
      width:40px; height:40px; border-radius:14px;
      background:#fff; border:1px solid #E5E7EB; color:#374151;
      transition:.2s;
    }
    .icon-btn:hover{ border-color:#F07E13; color:#F07E13; transform:translateY(-1px); }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- HEADER (même vibe que ton exemple: fixe mobile / sticky desktop) -->
  <header class="bg-white w-full z-50 border-b border-gray-200 shadow-[0_0_8px_0_rgba(0,0,0,0.13)] fixed lg:sticky top-0">
    <div class="max-w-[1240px] mx-auto px-3 lg:px-0 pt-4 pb-4 grid grid-cols-[auto_1fr_auto] gap-3 items-center">

      <!-- Left: menu mobile + logo -->
      <div class="flex items-center gap-3">
        <button id="menuBtn" class="lg:hidden" aria-label="Menu">
          <div class="flex flex-col gap-[6px] w-5">
            <span class="bg-[#F97316] h-[2px] rounded-lg w-full"></span>
            <span class="bg-[#F97316] h-[2px] rounded-lg w-full"></span>
            <span class="bg-[#F97316] h-[2px] rounded-lg w-full"></span>
          </div>
        </button>

        <a href="index.html" class="font-black tracking-tighter text-2xl leading-none">
          Viral<span class="text-orange-bsv">Flowr</span>
        </a>
      </div>

      <!-- Center: search -->
      <div class="relative w-full max-w-[636px] mx-auto">
        <input id="searchInp" class="input pr-12" autocomplete="off" placeholder="Que recherchez-vous ? Tapez ici" />
        <button id="searchBtn" class="absolute top-1/2 -translate-y-1/2 right-2 h-[32px] w-[32px] rounded-full bg-[#F07E13] flex items-center justify-center" aria-label="Rechercher">
          <svg height="18" width="18" viewBox="0 0 18.01 18.01" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.57,15.45,12.9,10.78a7,7,0,1,0-2.12,2.12l4.67,4.67a1.5,1.5,0,0,0,2.13-2.11ZM2,7a5,5,0,1,1,5,5A5,5,0,0,1,2,7Z" fill="#fff"></path>
          </svg>
        </button>
      </div>

      <!-- Right: auth + wallet -->
      <div class="flex items-center justify-end gap-2">
        <a id="authLink" href="login.html" class="btn btn-outline hidden sm:inline-flex">Se connecter</a>
        <a href="wallet.html" class="icon-btn" title="Portefeuille" aria-label="Portefeuille">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 7H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h13a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Z"/>
            <path d="M16 7V5a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v2"/>
            <path d="M20 12h-4a2 2 0 0 0 0 4h4"/>
            <circle cx="16" cy="14" r="0.5" />
          </svg>
        </a>
      </div>
    </div>

    <!-- Subnav categories -->
    <div class="hidden lg:block bg-white border-t border-gray-100">
      <nav class="max-w-[1240px] mx-auto px-3 lg:px-0 py-2">
        <div id="catsRow" class="flex items-center gap-3 overflow-x-auto whitespace-nowrap">
          <!-- Rempli par JS (catégories) -->
        </div>
      </nav>
    </div>

    <!-- Drawer mobile -->
    <div id="mobileMenu" class="lg:hidden hidden border-t border-gray-100 bg-white">
      <div class="max-w-[1240px] mx-auto px-3 py-3 flex flex-col gap-2">
        <a href="index.html" class="btn btn-outline justify-start">Boutique</a>
        <a href="wallet.html" class="btn btn-outline justify-start">Portefeuille</a>
        <a href="login.html" class="btn btn-outline justify-start">Connexion</a>
      </div>
    </div>
  </header>

  <!-- Spacer pour header fixed mobile -->
  <div class="h-[84px] lg:h-0"></div>

  <main class="flex-1 px-4">
    <div class="max-w-[1240px] mx-auto">

      <!-- Hero -->
      <section class="card p-6 md:p-8 mt-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <div class="text-[11px] font-black uppercase tracking-[.2em] text-gray-300">Boutique</div>
            <div class="text-3xl md:text-4xl font-black tracking-tighter mt-1">
              Achète & reçois instantanément
            </div>
            <div class="mt-2 text-[13px] font-semibold text-gray-600">
              Recherche, sélection, paiement et livraison.
            </div>
          </div>
          <div class="flex gap-2">
            <a href="wallet.html" class="btn brand-gradient text-white">Mon portefeuille</a>
            <a href="login.html" class="btn btn-outline">Mon compte</a>
          </div>
        </div>
      </section>

      <!-- ✅ TON CONTENU PRODUITS ICI -->
      <section class="mt-6">
        <div class="flex items-center justify-between mb-3">
          <div class="text-[11px] font-black uppercase tracking-[.18em] text-gray-300">Produits</div>
          <div class="text-[12px] font-extrabold text-gray-400" id="countLabel"></div>
        </div>

        <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </section>
    </div>
  </main>

  <footer class="bg-white border-t border-gray-200 py-8 mt-10">
    <div class="max-w-[1240px] mx-auto px-4 text-center">
      <p class="text-[11px] text-[#767676]">© 2026 ViralFlowr. Tous droits réservés.</p>
    </div>
  </footer>

  <script>
    // ✅ Garde ta logique: ici je ne fais que le STYLE + UI.
    // Branche ton API get_products comme d’habitude.

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx_Tm3cGZs4oYdKmPieUU2SCjegAvn-BTufubyqZTFU4geAiRXN53YYE9XVGdq_uq1H/exec";

    // Menu mobile
    const menuBtn = document.getElementById("menuBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    menuBtn?.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));

    // Session (comme ton wallet.html)
    function tryParse_(raw){ try { return JSON.parse(raw); } catch { return null; } }
    function getSession_(){
      const keys = ["vf_session","VF_SESSION","vfSession","VFSession","session","auth","vf_auth"];
      for(const k of keys){
        const raw = localStorage.getItem(k);
        if(!raw) continue;
        const s = tryParse_(raw);
        if(s && typeof s === "object") return s;
      }
      return null;
    }
    function pickStr_(v){ const s = String(v||"").trim(); return s ? s : ""; }
    function getAuth_(s){
      const email =
        pickStr_(s?.email) || pickStr_(s?.userEmail) || pickStr_(s?.mail) ||
        pickStr_(s?.username) || pickStr_(s?.user?.email) || "";
      const token =
        pickStr_(s?.token) || pickStr_(s?.sessionToken) || pickStr_(s?.access_token) ||
        pickStr_(s?.accessToken) || pickStr_(s?.jwt) || pickStr_(s?.user?.token) || "";
      return { email: email.toLowerCase(), token };
    }
    const authLink = document.getElementById("authLink");
    (function applyAuthUI_(){
      const s = getSession_();
      if(!authLink) return;
      if(!s){
        authLink.textContent = "Se connecter";
        authLink.href = "login.html";
        return;
      }
      const a = getAuth_(s);
      authLink.textContent = a.email ? a.email : "Compte";
      authLink.href = "wallet.html";
    })();

    // JSONP
    function jsonp_(params, onOk, onErr, timeoutMs=12000){
      const cb = "vf_cb_" + Date.now() + "_" + Math.floor(Math.random()*1000000);
      let done = false;

      const timer = setTimeout(() => {
        if(done) return;
        done = true;
        try { delete window[cb]; } catch(_){}
        onErr && onErr("TIMEOUT");
      }, timeoutMs);

      window[cb] = function(payload){
        if(done) return;
        done = true;
        clearTimeout(timer);
        try { onOk(payload); }
        finally { try { delete window[cb]; } catch(_){} }
      };

      const s = document.createElement("script");
      const qs = new URLSearchParams({ ...params, callback: cb, t: String(Date.now()) });
      s.src = SCRIPT_URL + "?" + qs.toString();
      s.onerror = function(){
        if(done) return;
        done = true;
        clearTimeout(timer);
        try { delete window[cb]; } catch(_){}
        onErr && onErr("NETWORK");
      };
      document.body.appendChild(s);
      s.onload = () => setTimeout(() => { try { s.remove(); } catch(_){ } }, 0);
    }

    // UI rendu produits (simple)
    const grid = document.getElementById("productsGrid");
    const catsRow = document.getElementById("catsRow");
    const countLabel = document.getElementById("countLabel");
    const searchInp = document.getElementById("searchInp");
    const searchBtn = document.getElementById("searchBtn");

    let ALL = [];
    let CURRENT_CAT = "all";

    function currencySymbol_(cur){
      const c = String(cur||"USD").toUpperCase();
      if(c==="USD") return "$";
      if(c==="EUR") return "€";
      if(c==="GBP") return "£";
      if(c==="CDF") return "FC";
      return c;
    }
    function fmt2(n){
      const x = Number(n||0);
      if(!isFinite(x)) return "0.00";
      return x.toFixed(2);
    }

    function renderCats_(items){
      const set = new Set(items.map(p => String(p.cat||"").trim()).filter(Boolean));
      const cats = ["all", ...Array.from(set)];
      catsRow.innerHTML = cats.map(c => {
        const active = (c === CURRENT_CAT);
        return `
          <button data-cat="${c}" class="px-4 py-2 rounded-full text-[12px] font-black uppercase tracking-widest border ${active ? 'border-[#F07E13] text-[#F07E13] bg-[#FFF7EE]' : 'border-gray-200 text-gray-500 bg-white'}">
            ${c === "all" ? "Tous" : c}
          </button>
        `;
      }).join("");

      catsRow.querySelectorAll("button[data-cat]").forEach(btn => {
        btn.addEventListener("click", () => {
          CURRENT_CAT = btn.getAttribute("data-cat") || "all";
          renderCats_(ALL);
          applyFilter_();
        });
      });
    }

    function renderProducts_(list){
      countLabel.textContent = list.length ? (list.length + " article(s)") : "";
      if(!list.length){
        grid.innerHTML = `<div class="text-sm font-bold text-gray-400">Aucun produit.</div>`;
        return;
      }
      grid.innerHTML = list.map(p => {
        const img = (p.img || "").trim();
        const price = fmt2(p.prix);
        return `
          <article class="card p-4">
            <div class="flex gap-3">
              <div class="w-16 h-16 rounded-2xl bg-gray-100 overflow-hidden shrink-0">
                ${img ? `<img src="${img}" alt="" class="w-full h-full object-cover">` : ``}
              </div>
              <div class="min-w-0">
                <div class="font-black text-[14px] leading-tight line-clamp-2">${p.nom || ""}</div>
                <div class="text-[12px] font-semibold text-gray-500 mt-1 line-clamp-2">${p.desc || ""}</div>
                <div class="mt-2 font-black text-[16px]">
                  ${price} <span class="text-gray-300">${currencySymbol_("USD")}</span>
                </div>
              </div>
            </div>
            <div class="mt-4 flex gap-2">
              <a href="product.html?id=${encodeURIComponent(p.id || "")}" class="btn btn-outline w-full">Voir</a>
              <button class="btn brand-gradient text-white w-full" onclick="location.href='checkout.html?id=${encodeURIComponent(p.id||"")}'">Acheter</button>
            </div>
          </article>
        `;
      }).join("");
    }

    function applyFilter_(){
      const q = String(searchInp.value || "").trim().toLowerCase();
      let list = ALL.slice();
      if(CURRENT_CAT !== "all") list = list.filter(p => String(p.cat||"").trim() === CURRENT_CAT);
      if(q) list = list.filter(p =>
        String(p.nom||"").toLowerCase().includes(q) ||
        String(p.desc||"").toLowerCase().includes(q)
      );
      renderProducts_(list);
    }

    function loadProducts_(){
      jsonp_(
        { action: "get_products", cat: "all" },
        (res) => {
          if(res && res.ok && Array.isArray(res.products)){
            ALL = res.products;
            renderCats_(ALL);
            applyFilter_();
          }else{
            grid.innerHTML = `<div class="text-sm font-bold text-gray-400">Erreur chargement produits.</div>`;
          }
        },
        () => grid.innerHTML = `<div class="text-sm font-bold text-gray-400">Erreur réseau.</div>`
      );
    }

    searchBtn?.addEventListener("click", applyFilter_);
    searchInp?.addEventListener("input", () => applyFilter_());

    loadProducts_();
  </script>
</body>
</html>
