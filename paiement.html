<!DOCTYPE html>
<html lang="fr" class="font-inter">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>ViralFlowr | Paiement SÃ©curisÃ©</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F3F3F3; }
        .brand-gradient { background: linear-gradient(135deg, #F07E13 0%, #FFB26B 100%); }
        .text-orange-bsv { color: #F07E13; }
        .checkout-container { max-width: 500px; width: 100%; margin: 2rem auto; }
        input, textarea { outline: none; transition: all 0.2s; }
        input:focus, textarea:focus { ring: 2px; ring-color: #F07E13; border-color: transparent; }
        .crypto-box { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 10px; margin-top: 8px; }
    </style>
</head>

<body class="p-4 md:p-8 text-[#201B16]">

    <div class="checkout-container">
        <div class="text-center mb-8">
            <a href="index.html" class="inline-block text-2xl font-black tracking-tighter mb-2">
                Viral<span class="text-orange-bsv">Flowr</span>
            </a>
            <p class="text-gray-400 text-xs font-bold uppercase tracking-widest">Finaliser votre achat</p>
        </div>

        <div class="bg-white rounded-[32px] shadow-sm border border-gray-100 p-6 md:p-8 relative">
            
            <div id="form-container">
                <h2 id="service-name" class="text-xl font-extrabold text-center mb-6">Chargement...</h2>

                <div class="bg-[#F8FAFC] border-2 border-dashed border-[#F07E13]/30 rounded-2xl p-4 text-center mb-6">
                    <span class="text-[10px] font-black text-orange-600 uppercase tracking-tighter">Note impÃ©rative Binance Pay</span>
                    <span id="live-order-id" class="block text-2xl font-black text-gray-900 my-1">#CMD-XXXX</span>
                    <button type="button" onclick="copyText(document.getElementById('live-order-id').innerText)" class="text-[10px] font-bold bg-gray-900 text-white px-3 py-1 rounded-full">COPIER L'ID</button>
                </div>

                <form id="orderForm" class="space-y-4">
                    <div id="section-smm" class="hidden space-y-4">
                        <input type="text" id="boost-link" placeholder="Lien Ã  booster" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm font-medium">
                        <input type="number" id="qty" value="1000" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm font-black">
                    </div>
                    <div id="section-abonnement" class="hidden space-y-4">
                        <textarea id="creds" placeholder="Identifiants (Email : Mot de passe)" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm font-medium h-24"></textarea>
                        <input type="text" id="delivery-contact-abo" placeholder="WhatsApp ou Email pour livraison" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm font-medium">
                    </div>
                    <div id="section-carte" class="hidden">
                        <input type="text" id="card-delivery" placeholder="Contact WhatsApp/Email de livraison" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm font-medium">
                    </div>
                    <div id="section-default" class="hidden space-y-4">
                        <input type="text" id="main-input" placeholder="Information requise" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm font-medium">
                        <input type="email" id="email-client" placeholder="Votre Email" class="w-full bg-gray-50 border-none rounded-xl p-3 text-sm font-medium">
                    </div>

                    <div class="py-4 text-center">
                        <div id="display-price" class="text-4xl font-black text-gray-900 tracking-tighter">0.00 $</div>
                    </div>

                    <div class="bg-gray-900 rounded-3xl p-6 text-white space-y-4 shadow-2xl">
                        <h4 class="text-[10px] font-black text-orange-400 uppercase tracking-[0.2em] border-b border-white/10 pb-3">Options de transfert</h4>
                        
                        <div class="flex justify-between items-center group">
                            <span class="text-xs opacity-60">Binance Pay ID</span>
                            <span class="text-sm font-bold cursor-pointer hover:text-orange-400" onclick="copyText('744370418')">744370418 ðŸ“‹</span>
                        </div>

                        <div class="crypto-box">
                            <span class="text-[9px] font-black text-blue-400 uppercase block">USDT (Network: TRC-20)</span>
                            <div class="flex justify-between items-center mt-1">
                                <span class="text-[10px] truncate mr-2 opacity-80" id="trc20-addr">TYv7N...vX9rW</span>
                                <button type="button" onclick="copyText('TON_ADRESSE_TRC20_ICI')" class="text-[10px] font-black bg-white/10 px-2 py-1 rounded">COPIER</button>
                            </div>
                        </div>

                        <div class="crypto-box">
                            <span class="text-[9px] font-black text-yellow-400 uppercase block">USDT (Network: BEP-20)</span>
                            <div class="flex justify-between items-center mt-1">
                                <span class="text-[10px] truncate mr-2 opacity-80" id="bep20-addr">0x7a2...F92a</span>
                                <button type="button" onclick="copyText('TON_ADRESSE_BEP20_ICI')" class="text-[10px] font-black bg-white/10 px-2 py-1 rounded">COPIER</button>
                            </div>
                        </div>

                        <div class="pt-2 space-y-2 border-t border-white/10">
                            <div class="flex justify-between items-center text-xs">
                                <span class="opacity-60 italic">Airtel (RDC)</span>
                                <span class="font-bold">0971028041</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[13px] font-bold text-gray-700 mb-2 italic">ðŸ“¸ Screenshot de la preuve</label>
                        <input type="file" id="file" accept="image/*" required class="w-full text-xs bg-white border border-gray-100 rounded-xl p-2">
                    </div>

                    <button type="submit" id="submitBtn" class="w-full brand-gradient text-white py-4 rounded-2xl font-black text-sm uppercase shadow-xl">
                        Valider mon paiement
                    </button>
                </form>
            </div>

            <div id="success-msg" class="hidden text-center py-10">
                <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg width="40" height="40" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"></path></svg>
                </div>
                <h3 class="text-2xl font-black text-gray-900 mb-2">Merci !</h3>
                <p class="text-gray-500 text-sm mb-6">Commande <strong id="final-id"></strong> enregistrÃ©e.</p>
                <button onclick="location.href='index.html'" class="w-full bg-gray-900 text-white py-4 rounded-2xl font-black text-sm uppercase">Retour Accueil</button>
            </div>
        </div>
    </div>

    <script>
        const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbyCvuy-WiLMlAkBb7k6YyPVMk4lQhGGke05heSWSw--twKE2L-oVSOs884g3jn6lt6m/exec";
        
        // Logique de copier coller
        function copyText(txt) {
            navigator.clipboard.writeText(txt);
            alert("CopiÃ© dans le presse-papier !");
        }

        // Recuperation des paramÃ¨tres
        const params = new URLSearchParams(window.location.search);
        const nom = params.get('nom') || "Service";
        const prixInitial = parseFloat(params.get('prix')) || 0;
        const cat = params.get('cat') || "";
        const idS = params.get('id') || "";
        
        document.getElementById('service-name').innerText = nom;
        let orderId = "#VF-" + Math.floor(1000 + Math.random()*9000);
        document.getElementById('live-order-id').innerText = orderId;

        // Gestion de l'affichage dynamique par catÃ©gorie
        const catUpper = cat.toUpperCase();
        if (catUpper.includes("BOOST") || catUpper.includes("SMM")) {
            document.getElementById('section-smm').classList.remove('hidden');
            const qty = document.getElementById('qty');
            qty.addEventListener('input', () => {
                document.getElementById('display-price').innerText = ((prixInitial / 1000) * qty.value).toFixed(2) + " $";
            });
            document.getElementById('display-price').innerText = prixInitial.toFixed(2) + " $";
        } else if (catUpper.includes("ABONNEMENT")) {
            document.getElementById('section-abonnement').classList.remove('hidden');
            document.getElementById('display-price').innerText = prixInitial.toFixed(2) + " $";
        } else if (catUpper.includes("CARTE")) {
            document.getElementById('section-carte').classList.remove('hidden');
            document.getElementById('display-price').innerText = prixInitial.toFixed(2) + " $";
        } else {
            document.getElementById('section-default').classList.remove('hidden');
            document.getElementById('display-price').innerText = prixInitial.toFixed(2) + " $";
        }

        // ENVOI FORMULAIRE
        document.getElementById('orderForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true; btn.innerText = "Chargement...";

            const file = document.getElementById('file').files[0];
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const payload = {
                    orderId: orderId,
                    produit: nom,
                    total: document.getElementById('display-price').innerText,
                    fileData: reader.result,
                    input1: document.getElementById('boost-link').value || document.getElementById('main-input').value || document.getElementById('creds').value,
                    email: document.getElementById('delivery-contact-abo').value || document.getElementById('card-delivery').value || document.getElementById('email-client').value,
                    quantite: document.getElementById('qty')?.value || "1"
                };

                await fetch(GOOGLE_URL, { method:'POST', mode:'no-cors', body: JSON.stringify(payload) });
                
                // LANCER LES CONFETTIS
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#F07E13', '#FFB26B', '#201B16']
                });

                document.getElementById('form-container').classList.add('hidden');
                document.getElementById('final-id').innerText = orderId;
                document.getElementById('success-msg').classList.remove('hidden');
            };
        };
    </script>
</body>
</html>
