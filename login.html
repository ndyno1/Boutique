<!DOCTYPE html>
<html lang="fr" class="font-inter">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ViralFlowr | Boutique</title>

  <meta name="theme-color" content="#111827" />
  <link rel="icon" href="favicon.png" />
  <link rel="apple-touch-icon" href="favicon.png" />

  <!-- Tailwind (dev) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    html, body { width:100%; max-width:100%; overflow-x:hidden; }
    body{
      font-family:'Inter',sans-serif;
      background:#F8FAFC;
      min-height:100svh;
      padding-bottom: env(safe-area-inset-bottom);
    }
    .brand-gradient { background: linear-gradient(135deg, #F07E13 0%, #FFB26B 100%); }
    .icon-btn{
      display:flex; align-items:center; justify-content:center;
      width:40px; height:40px; border-radius:14px;
      background:#fff; border:1px solid #E5E7EB; color:#374151;
      transition:.2s; -webkit-tap-highlight-color: transparent;
    }
    .icon-btn:hover{ border-color:#F07E13; color:#F07E13; transform:translateY(-1px); }
    .btn-auth{
      padding: 9px 14px; border-radius: 14px; font-weight: 900; font-size: 11px;
      text-transform: uppercase; letter-spacing: .12em; transition: .25s;
      display: inline-flex; align-items: center; gap: 8px; white-space: nowrap;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-auth-outline{ background:white; border:1px solid #E5E7EB; color:#111827; }
    .btn-auth-outline:hover{ border-color:#F07E13; color:#F07E13; }
    .btn-auth-solid{ color:white; }
    .badge-soft{
      display:inline-flex; align-items:center; gap:6px;
      font-size:10px; font-weight:900; letter-spacing:.16em;
      text-transform:uppercase;
      padding:7px 10px; border-radius:999px;
      border:1px solid #E5E7EB;
      background:#fff;
      color:#111827;
    }
    .price{
      font-weight:900; letter-spacing:-.02em;
    }
    .card-hover{
      transition: .2s;
    }
    .card-hover:hover{
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(17,24,39,.08);
      border-color:#F07E13;
    }
  </style>
</head>

<body>

  <div class="bg-gray-900 text-white py-2 text-[10px] font-black uppercase tracking-[0.2em] text-center">
    BOUTIQUE • SERVICES & ABONNEMENTS
  </div>

  <header class="bg-white sticky top-0 w-full z-50 border-b border-gray-100 shadow-sm">
    <div class="max-w-[1280px] mx-auto px-4 h-16 flex items-center justify-between gap-2 sm:gap-4">
      <a href="index.html" class="flex items-center gap-2 shrink-0" aria-label="ViralFlowr">
        <div class="text-2xl font-black tracking-tighter text-gray-900">
          Viral<span class="text-[#F07E13]">Flowr</span>
        </div>
      </a>

      <div class="flex items-center gap-2 sm:gap-3">
        <!-- Etat connexion -->
        <div id="authGuest" class="flex items-center gap-2 sm:gap-3">
          <a href="login.html?next=index.html" class="btn-auth btn-auth-outline">Connexion</a>
          <a href="register.html?next=index.html" class="btn-auth brand-gradient btn-auth-solid">Inscription</a>
        </div>

        <div id="authUser" class="hidden items-center gap-2 sm:gap-3">
          <button id="accountBtn" class="btn-auth btn-auth-outline" type="button" title="Compte">
            <span class="hidden sm:inline">Compte</span>
            <span id="userTag" class="text-gray-400 font-black tracking-widest text-[10px] hidden md:inline">—</span>
          </button>
          <button id="logoutBtn" class="btn-auth btn-auth-outline" type="button" title="Déconnexion">
            Déconnexion
          </button>
        </div>

        <button id="cartBtn" class="icon-btn" title="Panier (démo)" aria-label="Panier">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.7 13.4a2 2 0 0 0 2 1.6h9.7a2 2 0 0 0 2-1.6L23 6H6"></path>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-[1280px] mx-auto px-4 py-8">
    <!-- Bandeau statut -->
    <div id="statusBar" class="hidden mb-6 rounded-[22px] border border-gray-100 bg-white p-4 md:p-5 shadow-sm">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div class="flex items-start gap-3">
          <div class="w-10 h-10 rounded-2xl brand-gradient flex items-center justify-center text-white font-black">VF</div>
          <div>
            <div class="text-sm font-black text-gray-900" id="statusTitle">Statut</div>
            <div class="text-xs font-bold text-gray-400" id="statusSubtitle">—</div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <span id="priceModeBadge" class="badge-soft">PRIX PUBLIC</span>
          <a id="goLoginCta" href="login.html?next=index.html" class="btn-auth brand-gradient btn-auth-solid hidden">
            Activer prix revendeur
          </a>
        </div>
      </div>
    </div>

    <!-- Hero -->
    <section class="bg-white rounded-[28px] border border-gray-100 shadow-sm p-6 md:p-10">
      <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
        <div>
          <h1 class="text-3xl md:text-4xl font-black tracking-tighter text-gray-900">
            Boutique <span class="text-[#F07E13]">ViralFlowr</span>
          </h1>
          <p class="text-sm md:text-base font-semibold text-gray-400 mt-3 max-w-[720px] leading-relaxed">
            Achète tes services en quelques clics. Si tu es revendeur, connecte-toi pour afficher les <span class="text-gray-900">prix revendeur</span>.
          </p>

          <div class="mt-5 flex flex-wrap items-center gap-2">
            <span class="badge-soft">PAYMENTS</span>
            <span class="badge-soft">AUTO-DELIVERY</span>
            <span class="badge-soft">SUPPORT</span>
          </div>
        </div>

        <div class="bg-gray-50 border border-gray-100 rounded-[24px] p-4 md:p-5 min-w-[280px]">
          <div class="text-[11px] font-black uppercase tracking-widest text-gray-400">Session</div>
          <div class="mt-2 text-sm font-black text-gray-900" id="sessionLine">Non connecté</div>
          <div class="mt-1 text-xs font-bold text-gray-400" id="tokenLine">Token: —</div>
        </div>
      </div>
    </section>

    <!-- Produits -->
    <section class="mt-8">
      <div class="flex items-end justify-between gap-4">
        <h2 class="text-xl md:text-2xl font-black tracking-tighter text-gray-900">Services</h2>

        <div class="flex items-center gap-2">
          <input id="searchInput" type="text"
            class="h-11 w-[220px] md:w-[320px] px-4 rounded-2xl bg-white border border-gray-100 shadow-sm text-sm font-semibold outline-none focus:ring-2 focus:ring-[#F07E13]"
            placeholder="Rechercher un service..." />
        </div>
      </div>

      <div id="productsGrid" class="mt-5 grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    </section>
  </main>

  <!-- Modal simple (démo) -->
  <div id="modal" class="hidden fixed inset-0 z-[999] bg-black/40 p-4">
    <div class="max-w-[560px] mx-auto mt-10 bg-white rounded-[26px] border border-gray-100 shadow-xl overflow-hidden">
      <div class="p-5 border-b border-gray-100 flex items-center justify-between">
        <div>
          <div class="text-lg font-black tracking-tighter text-gray-900" id="modalTitle">—</div>
          <div class="text-xs font-bold text-gray-400" id="modalSubtitle">—</div>
        </div>
        <button id="closeModal" class="icon-btn" aria-label="Fermer">
          ✕
        </button>
      </div>
      <div class="p-5">
        <div class="text-sm font-semibold text-gray-600 leading-relaxed" id="modalDesc">—</div>

        <div class="mt-5 flex items-center justify-between gap-3 bg-gray-50 border border-gray-100 rounded-2xl p-4">
          <div>
            <div class="text-[11px] font-black uppercase tracking-widest text-gray-400">Prix</div>
            <div class="mt-1 text-2xl font-black text-gray-900 price" id="modalPrice">—</div>
          </div>
          <button id="buyBtn" class="h-11 px-5 rounded-2xl brand-gradient text-white font-black uppercase tracking-widest text-[12px] shadow-md hover:opacity-95 transition">
            Commander
          </button>
        </div>

        <div class="mt-4 text-[11px] font-bold text-gray-400">
          Démo : le paiement/commande sera branché plus tard sur ton système.
        </div>
      </div>
    </div>
  </div>

  <script>
    // --------------------------
    // Données démo (remplace par tes produits réels)
    // public_price / reseller_price peuvent venir d'une DB plus tard
    // --------------------------
    const PRODUCTS = [
      { id:"SMM-IG-1000", name:"Instagram Followers 1K", cat:"SMM", public_price: 8, reseller_price: 5, unit:"/ 1000", desc:"Ajout progressif. Délai variable selon charge." },
      { id:"SMM-TT-1000", name:"TikTok Likes 1K", cat:"SMM", public_price: 6, reseller_price: 4, unit:"/ 1000", desc:"Likes rapides, idéal pour booster un post." },
      { id:"SMM-YT-1000", name:"YouTube Views 1K", cat:"SMM", public_price: 7, reseller_price: 4.5, unit:"/ 1000", desc:"Vues stables, livraison selon disponibilité." },
      { id:"IMEI-CHK", name:"IMEI Check Basic", cat:"IMEI", public_price: 3, reseller_price: 2, unit:"", desc:"Vérification modèle / statut (selon fournisseur)." },
      { id:"SUB-SNAP-1M", name:"Snapchat+ 1 Mois", cat:"ABO", public_price: 6, reseller_price: 4, unit:"", desc:"Activation selon compte et région supportée." },
      { id:"SUB-SNAP-3M", name:"Snapchat+ 3 Mois", cat:"ABO", public_price: 12, reseller_price: 9, unit:"", desc:"Meilleure valeur. Nécessite compte compatible." },
      { id:"WALLET-TOPUP", name:"Rechargement Portefeuille", cat:"WALLET", public_price: 0, reseller_price: 0, unit:"", desc:"Utilise la page portefeuille (bientôt intégrée ici)." },
      { id:"VIP-SUPPORT", name:"Support VIP", cat:"SUPPORT", public_price: 5, reseller_price: 3, unit:"", desc:"Priorité sur les tickets + suivi." },
    ];

    // --------------------------
    // Helpers
    // --------------------------
    const $ = (id) => document.getElementById(id);

    function safeJsonParse_(s){
      try { return JSON.parse(s); } catch(_) { return null; }
    }

    function getSession_(){
      const raw = localStorage.getItem("vf_session");
      const obj = raw ? safeJsonParse_(raw) : null;
      if (!obj || typeof obj !== "object") return null;
      return obj;
    }

    function isReseller_(session){
      // Revendeur si token existe OU flag is_reseller true
      const token = String(localStorage.getItem("vf_token") || "");
      return !!(token && token.length > 10) || !!(session && session.is_reseller);
    }

    function formatPrice_(n){
      const v = Number(n || 0);
      // format simple
      return v === 0 ? "Sur devis" : (v % 1 === 0 ? v.toFixed(0) : v.toFixed(2)) + " $";
    }

    // --------------------------
    // UI Auth + Pricing mode
    // --------------------------
    function renderAuthUI_(){
      const session = getSession_();
      const token = String(localStorage.getItem("vf_token") || "");
      const reseller = isReseller_(session);

      // Auth UI
      if (session) {
        $("authGuest").classList.add("hidden");
        $("authUser").classList.remove("hidden");
        $("authUser").classList.add("flex");
        $("userTag").textContent = (session.username || session.email || "Utilisateur");
      } else {
        $("authUser").classList.add("hidden");
        $("authUser").classList.remove("flex");
        $("authGuest").classList.remove("hidden");
      }

      // Session box
      $("sessionLine").textContent = session ? ("Connecté : " + (session.email || "—")) : "Non connecté";
      $("tokenLine").textContent = "Token: " + (token ? (token.slice(0, 6) + "…" + token.slice(-4)) : "—");

      // Status bar
      $("statusBar").classList.remove("hidden");

      if (!session) {
        $("statusTitle").textContent = "Mode invité";
        $("statusSubtitle").textContent = "Connecte-toi pour afficher les prix revendeur (si autorisé).";
        $("priceModeBadge").textContent = "PRIX PUBLIC";
        $("goLoginCta").classList.remove("hidden");
      } else if (reseller) {
        $("statusTitle").textContent = "Prix revendeur activés";
        $("statusSubtitle").textContent = "Ton token est détecté. Les prix revendeur sont affichés.";
        $("priceModeBadge").textContent = "PRIX REVENDEUR";
        $("goLoginCta").classList.add("hidden");
      } else {
        $("statusTitle").textContent = "Connecté (prix public)";
        $("statusSubtitle").textContent = "Ton compte est connecté, mais aucun token revendeur n’est détecté.";
        $("priceModeBadge").textContent = "PRIX PUBLIC";
        $("goLoginCta").classList.add("hidden");
      }

      // Appliquer prix
      applyPricing_(reseller);
    }

    function applyPricing_(useReseller){
      // Basculer chaque card
      document.querySelectorAll("[data-product-card='1']").forEach(card => {
        const pubEl = card.querySelector("[data-price-public='1']");
        const resEl = card.querySelector("[data-price-reseller='1']");
        if (!pubEl || !resEl) return;

        if (useReseller) {
          pubEl.classList.add("hidden");
          resEl.classList.remove("hidden");
        } else {
          resEl.classList.add("hidden");
          pubEl.classList.remove("hidden");
        }
      });
    }

    // --------------------------
    // Render products
    // --------------------------
    function renderProducts_(list){
      const grid = $("productsGrid");
      grid.innerHTML = "";

      list.forEach(p => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-[26px] border border-gray-100 shadow-sm p-5 card-hover cursor-pointer";
        card.setAttribute("data-product-card", "1");

        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-[11px] font-black uppercase tracking-widest text-gray-400">${p.cat}</div>
              <div class="mt-1 text-lg font-black tracking-tighter text-gray-900">${escapeHtml_(p.name)}</div>
              <div class="mt-1 text-xs font-bold text-gray-400">${escapeHtml_(p.id)}</div>
            </div>
            <span class="badge-soft">FAST</span>
          </div>

          <div class="mt-4 text-sm font-semibold text-gray-600 leading-relaxed line-clamp-3">
            ${escapeHtml_(p.desc || "")}
          </div>

          <div class="mt-5 flex items-end justify-between gap-3 bg-gray-50 border border-gray-100 rounded-2xl p-4">
            <div>
              <div class="text-[11px] font-black uppercase tracking-widest text-gray-400">Prix</div>

              <div class="mt-1 text-2xl font-black text-gray-900 price" data-price-public="1">
                ${formatPrice_(p.public_price)} <span class="text-xs font-black text-gray-400">${escapeHtml_(p.unit || "")}</span>
              </div>

              <div class="mt-1 text-2xl font-black text-gray-900 price hidden" data-price-reseller="1">
                ${formatPrice_(p.reseller_price)} <span class="text-xs font-black text-gray-400">${escapeHtml_(p.unit || "")}</span>
              </div>
            </div>

            <div class="flex items-center gap-2">
              <span class="text-[10px] font-black uppercase tracking-[0.2em] text-gray-400">VOIR</span>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#111827" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 18l6-6-6-6"></path>
              </svg>
            </div>
          </div>
        `;

        card.addEventListener("click", () => openModal_(p));
        grid.appendChild(card);
      });

      // Applique pricing après render
      const session = getSession_();
      applyPricing_(isReseller_(session));
    }

    function escapeHtml_(str){
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // --------------------------
    // Modal
    // --------------------------
    function openModal_(p){
      const session = getSession_();
      const useReseller = isReseller_(session);
      const price = useReseller ? p.reseller_price : p.public_price;

      $("modalTitle").textContent = p.name;
      $("modalSubtitle").textContent = p.id + " • " + p.cat;
      $("modalDesc").textContent = p.desc || "";
      $("modalPrice").textContent = formatPrice_(price) + (p.unit ? (" " + p.unit) : "");

      $("modal").classList.remove("hidden");
      document.body.style.overflow = "hidden";

      $("buyBtn").onclick = () => {
        // Démo : ici tu brancheras ton flow commande/paiement
        alert("Commande (démo) : " + p.id + "\\nPrix: " + formatPrice_(price));
      };
    }

    function closeModal_(){
      $("modal").classList.add("hidden");
      document.body.style.overflow = "";
    }

    $("closeModal").addEventListener("click", closeModal_);
    $("modal").addEventListener("click", (e) => {
      if (e.target === $("modal")) closeModal_();
    });

    // --------------------------
    // Logout
    // --------------------------
    $("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("vf_session");
      localStorage.removeItem("vf_token");
      localStorage.setItem("vf_session_changed", String(Date.now()));
      renderAuthUI_();
    });

    // --------------------------
    // Search
    // --------------------------
    $("searchInput").addEventListener("input", () => {
      const q = String($("searchInput").value || "").trim().toLowerCase();
      const filtered = PRODUCTS.filter(p =>
        (p.name || "").toLowerCase().includes(q) ||
        (p.id || "").toLowerCase().includes(q) ||
        (p.cat || "").toLowerCase().includes(q)
      );
      renderProducts_(filtered);
    });

    // --------------------------
    // Sync onglets
    // --------------------------
    window.addEventListener("storage", (e) => {
      if (e.key === "vf_session_changed" || e.key === "vf_session" || e.key === "vf_token") {
        renderAuthUI_();
      }
    });

    // --------------------------
    // Init
    // --------------------------
    renderProducts_(PRODUCTS);
    renderAuthUI_();

    // Bouton panier (démo)
    $("cartBtn").addEventListener("click", () => alert("Panier (démo)."));
    $("accountBtn").addEventListener("click", () => {
      const s = getSession_();
      alert(s ? ("Compte: " + (s.email || "—")) : "Non connecté");
    });
  </script>

</body>
</html>
